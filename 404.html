<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title id="pageTitle">Profile - Coolbrador</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        body{background:#111;color:#fff;font-family:sans-serif;margin:0}
        .c{max-width:800px;margin:40px auto;padding:30px;background:#1a1a1a;border-radius:12px}
        .a{width:160px;height:160px;border-radius:50%;border:5px solid #0099ff;object-fit:cover}
        #f{display:none}
        .e{background:#0099ff;color:white;padding:8px 16px;border-radius:6px;cursor:pointer;display:none}
    </style>
</head>
<body>
    <div id="h"></div>
    <div class="c">
        <div style="display:flex;gap:30px;align-items:center">
            <img id="a" class="a" alt="">
            <h1 id="u">Loadingâ€¦</h1>
        </div>
        <div style="text-align:center;margin:20px">
            <label class="e" id="b">Change Photo</label>
            <input type="file" id="f" accept="image/*">
        </div>
        <hr><h2>About</h2><p>No bio yet.</p>
    </div>
    <div id="ftr"></div>

<script>
const id = location.pathname.split("/")[2] || localStorage.getItem("currentUserId") || "default";
const me = localStorage.getItem("currentUserId");
const owner = localStorage.getItem("loggedIn")==="true" && me===id;

const data = id==="default" ? null : JSON.parse(localStorage.getItem(id)||"null");

if (!data && id!=="default") {
    document.getElementById("u").textContent = "User not found";
} else {
    document.getElementById("u").textContent = data?.username || "Guest";
    document.getElementById("pageTitle").textContent = (data?.username||"Guest")+" - Coolbrador";
}

document.getElementById("a").src = localStorage.getItem("pfp_"+id) || "/users/default/pfp.jpg";

if (owner) document.getElementById("b").style.display = "inline-block";

document.getElementById("b").onclick = ()=>document.getElementById("f").click();
document.getElementById("f").onchange = e=>{
    const file = e.target.files[0];
    if(!file) return;
    const r = new FileReader();
    r.onload = ()=> {
        localStorage.setItem("pfp_"+id, r.result);
        document.getElementById("a").src = r.result;
    };
    r.readAsDataURL(file);
};

fetch("/shared/header.html").then(r=>r.text()).then(t=>document.getElementById("h").innerHTML=t);
fetch("/shared/footer.html").then(r=>r.text()).then(t=>document.getElementById("ftr").innerHTML=t);
</script>
</body>
</html>
