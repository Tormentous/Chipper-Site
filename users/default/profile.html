<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title id="pageTitle">Profile - Coolbrador</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        .profile-container{max-width:800px;margin:40px auto;padding:30px;background:#1a1a1a;border-radius:12px;color:#fff}
        .profile-avatar{width:160px;height:160px;border-radius:50%;border:5px solid #0099ff;object-fit:cover}
        #fileInput{display:none}
        .edit-btn{background:#0099ff;color:white;padding:8px 16px;border-radius:6px;cursor:pointer;display:none}
    </style>
</head>
<body>
    <div id="shared-header"></div>
    <div class="profile-container">
        <div style="display:flex;align-items:center;gap:30px">
            <img id="avatar" class="profile-avatar" alt="Avatar">
            <div>
                <h1 id="username">Loading…</h1>
                <p id="country">-</p>
            </div>
        </div>
        <div style="text-align:center;margin:20px 0">
            <label class="edit-btn" id="changePhotoBtn">Change Photo</label>
            <input type="file" id="fileInput" accept="image/*">
        </div>
        <div class="profile-stats">…</div>
        <hr><h2>About</h2><p id="bio">No bio yet.</p>
    </div>
    <div id="shared-footer"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const userId = location.pathname.split("/")[2]; // extracts 0, 67, etc.
    const currentUserId = localStorage.getItem("currentUserId");
    const isOwner = localStorage.getItem("loggedIn")==="true" && currentUserId===userId;

    const data = userId && userId!=="default" ? JSON.parse(localStorage.getItem(userId)||"null") : null;

    if (!data && userId!=="default") {
        document.getElementById("username").textContent = "User not found";
        return;
    }

    const username = data?.username || "Guest";
    document.getElementById("username").textContent = username;
    document.getElementById("pageTitle").textContent = username + " - Coolbrador";

    const avatar = document.getElementById("avatar");
    avatar.src = localStorage.getItem("pfp_"+userId) || "/users/default/pfp.jpg";

    if (isOwner) document.getElementById("changePhotoBtn").style.display = "inline-block";

    document.getElementById("changePhotoBtn").onclick = () => document.getElementById("fileInput").click();
    document.getElementById("fileInput").onchange = e => {
        const file = e.target.files[0];
        if (!file) return;
        const r = new FileReader();
        r.onload = () => {
            localStorage.setItem("pfp_"+userId, r.result);
            avatar.src = r.result;
            alert("Photo updated!");
        };
        r.readAsDataURL(file);
    };

    fetch("/shared/header.html").then(r=>r.text()).then(t=>document.getElementById("shared-header").innerHTML=t);
    fetch("/shared/footer.html").then(r=>r.text()).then(t=>document.getElementById("shared-footer").innerHTML=t);
});
</script>
</body>
</html>
